var map, tileLayer;
map = L.map("could-be-map");
tileLayer = L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png", {
              attribution: "&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> &copy; <a href='http://carto.com/attribution'>CARTO</a>",
              subdomains: "abcd",
              maxZoom: 18
            }).addTo(map);
map.setView([40.730833, -73.9975], 16);
// Define the features array.
var couldBeFeatures;
$.getJSON("https://the-javascripting-english-major.org/could-be.geo.json", function(data){
  // Define the Leaflet layer.
  var couldBeLayer;
  // Iterate over the .features property of the GeoJSON object to
  // create an array of objects (features), with every object’s
  // properties as noted.
  couldBeFeatures = data.features.map(function(feature){
    // This return returns an object.
    return {
      name: feature.properties.name,
      html: feature.properties.html,
      tab: feature.properties.tab,
      mentions: feature.properties.mentions,
      lines: feature.properties.lines,
      wikipedia: feature.properties.wikipedia,
      // Create an L.latLng object out of the GeoJSON coordinates.
      // Remember that in GeoJSON, the coordinates are reversed
      // (longitude, then latitude).
      latLng: L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0])
    };
  });
  // Now create a Leaflet feature group made up of markers for each
  // object in couldBeFeatures.
  couldBeLayer = L.featureGroup(couldBeFeatures.map(function(feature){
    return L.marker(feature.latLng);
    })
  )
  // Add the layer to the map.
  couldBeLayer.addTo(map);
  // Redraw the map so that all the markers are visible.
  map.fitBounds(couldBeLayer.getBounds());
  // Zoom out one level to give some padding.
  map.zoomOut(1);
});
// Define and assign a Markdown-it renderer.
// Define and assign a Markdown-it renderer.
var md;
md = window.markdownit({html: true}).use(window.markdownitFootnote);
// Load the Markdown file with jQuery.
["hastings-street", "eighteenth-and-vine",
  "fifth-and-mound", "introduction",
  "lenox-avenue", "rampart"].forEach(function(tab){
  // Create a variable tab that has the name as a string.
  $.ajax({
    // tab + ".md" yields, for example, "rampart.md".
    url: "http://the-javascripting-english-major.org/examples/markdown/" + tab + ".md",
    success: function(markdown){
      var html;
      html = md.render(markdown);
      // "#rampart", for example.
      $("#" + tab).html(html);
    }
  });
});

$.ajax({
  url: "http://the-javascripting-english-major.org/examples/markdown/poem.md",
  success: function(poem){
    var html;
    html = md.render(poem);
    $("#poem").html(html);
    // The above is the same as the $.ajax() call in the prev. ch.
    $("#poem").html(function(_, oldHtml){
      var newHtml;
      newHtml = oldHtml.replace(/Hastings Street/g, "<a href='#' data-place='hastings-street'>Hastings Street</a>");
      return newHtml;
    });
  }
});
var placesArray;
 placesArray = [
   {text: "Hastings Street", tab: "hastings-street", html: "Hastings Street"},
   {text: "18th & Vine", tab: "eighteenth-and-vine", html: "18th &amp; Vine"}, ]
$.ajax({
  url: "http://the-javascripting-english-major.org/examples/markdown/poem.md",
  success: function(poem){
    // Read in the poem.
    var html;
    // Use the Markdown-it renderer I defined last chapter.
    html = md.render(poem);
    $("#poem").html(html);
    // Once the poem is in, start the loop.
    couldBeFeatures.forEach(function(feature){
      $("#poem").html(function(_, oldHtml){
        var regex, newHtml;
        // Assign the the regex the value of feature.html and the
        // flag “g”. This is the equivalent to /Hastings Street/g.
        regex = RegExp(feature.html, "g");
        // Fill in newHtml with the properties from the couldBeFeatures.
        newHtml = "<a href='#' data-tab='" + feature.tab + "'>" + feature.html + "</a>";
        // Return the newHtml wherever `replace()` finds the value
        // of regex.
        return oldHtml.replace(regex, newHtml);
      });
    });
  }
});
$("#poem a").click(function(){
  // Do something when you click.
});
$("#nav-tabs a[href='#" + $( this ).data("tab") + "']").tab("show");
$.ajax({
  url: "http://the-javascripting-english-major.org/examples/markdown/poem.md",
  success: function(poem){
    // Read in the poem.
    var html;
    // Use the Markdown-it renderer I defined last chapter.
    html = md.render(poem);
    $("#poem").html(html);
    // Once the poem is in, start the loop.
    couldBeFeatures.forEach(function(feature){
      $("#poem").html(function(_, oldHtml){
        // Define two new variables, lat and lng.
        var tab, lat, lng;
        tab = $( this ).data("tab");
        $("#nav-tabs a[href='#" + tab + "']").tab("show");
        lat = $( this ).data("lat");
        lng = $( this ).data("lng");
 map.panTo([lat, lng]);
        var regex, newHtml;
        // Assign the the regex the value of feature.html and the
        // flag “g”. This is the equivalent to /Hastings Street/g.
        regex = RegExp(feature.html, "g");
        // Fill in newHtml with the properties from the couldBeFeatures.
        newHtml = "<a href='#' data-tab='" +
          feature.tab +
          "' data-lat='" +
          feature.latLng.lat +
          "' data-lng='" +
          feature.latLng.lng +
          "'>" + feature.html + "</a>";
        // Return the newHtml wherever `replace()` finds the value
        // of regex.
        return oldHtml.replace(regex, newHtml);
      });
    });
  }
});
